<p>Kubernetes cluster have a default scheduler kube-scheduler. If the default scheduler does not suits our requirement we can also create our own scheduler. In the post we will discus how to create multiple scheduler and schedule pods based on different scheduler.</p>

<h3 id="setup"><strong>Setup</strong></h3>

<p>I am using the Virtualbox(running in Ubuntu 18.04 physical machine) for this entire setup . The physical machine is Dell inspiron laptop with 12GB RAM , Intel® Core™ i7-6500U CPU @ 2.50GHz × 4 and 512GB SSD hardisk.</p>

<!--kg-card-begin: image-->
<figure class="kg-card kg-image-card"><img src="/content/images/2019/11/setup-4.jpg" class="kg-image" /></figure>
<!--kg-card-end: image-->
<h5 id="step-1-copy-the-default-scheduler-yaml-and-modify">Step 1: Copy the default scheduler yaml and modify</h5>

<p>Copy the default scheduler yaml from master node and modify the name.</p>

<p>In this below example i am naming the custom schedule are <em>my-scheduler.</em> Add a ServiceAccount and ClusterRoleBinding to the yaml file as given below.</p>

<p>The key changes made are</p>

<ul>
  <li>line 27: name: my-scheduler</li>
  <li>line 30: serviceAccountName: my-scheduler</li>
  <li>line 38: - –leader-elect=false</li>
  <li>line 39: - –scheduler-name=my-scheduler</li>
</ul>

<figure class="highlight"><pre><code class="language-console" data-lang="console"><span class="gp">vikki@kubernetes1:~$</span><span class="w"> </span><span class="nb">sudo cp</span> /etc/kubernetes/manifests/kube-scheduler.yaml custom-scheduler.yaml
<span class="gp">vikki@kubernetes1:~$</span><span class="w"> </span><span class="nb">sudo chmod </span>777 custom-scheduler.yaml 
<span class="gp">vikki@kubernetes1:~$</span><span class="w"> </span>vim custom-scheduler.yaml </code></pre></figure>
<!--kg-card-begin: html-->
<script src="https://gist.github.com/vigneshragupathy/2a8e765cb702a7f8edf4e8760599da10.js"></script>
<!--kg-card-end: html-->
<h5 id="step-2-create-the-custom-scheduler">Step 2: Create the custom scheduler</h5>

<figure class="highlight"><pre><code class="language-console" data-lang="console"><span class="gp">vikki@kubernetes1:~$</span><span class="w"> </span>kubectl create <span class="nt">-f</span> custom-scheduler.yaml 
<span class="go">serviceaccount/my-scheduler created
clusterrolebinding.rbac.authorization.k8s.io/my-scheduler-as-kube-scheduler created
pod/my-scheduler created</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-console" data-lang="console"><span class="gp">vikki@kubernetes1:~$</span><span class="w"> </span>kubectl get pods <span class="nt">-n</span><span class="o">=</span>kube-system 
<span class="go">NAME READY STATUS RESTARTS AGE
calico-kube-controllers-55754f75c-fgs8g 1/1 Running 7 22d
calico-node-4h72l 1/1 Running 7 22d
calico-node-ld84s 1/1 Running 7 22d
calico-node-lrfz9 1/1 Running 2 31h
calico-node-ws576 1/1 Running 1 27h
coredns-5644d7b6d9-2g6rs 1/1 Running 7 22d
coredns-5644d7b6d9-ccxsg 1/1 Running 7 22d
etcd-kubernetes1 1/1 Running 8 22d
kube-apiserver-kubernetes1 1/1 Running 8 22d
kube-controller-manager-kubernetes1 1/1 Running 8 22d
kube-proxy-6xd8l 1/1 Running 2 31h
kube-proxy-96q5x 1/1 Running 7 22d
kube-proxy-njl6r 1/1 Running 7 22d
kube-proxy-whlhw 1/1 Running 1 27h
kube-scheduler-kubernetes1 1/1 Running 8 22d
my-scheduler 1/1 Running 0 6s</span></code></pre></figure>

<blockquote>
  <p>Now we can see a new custom scheduler <em>my-scheduler</em> is running along with defautl scheduler <em>kube-scheduler-kubernetes1</em></p>
</blockquote>

<h5 id="step-3-edit-the-custerrole-for-kube-scheduler">Step 3: Edit the custerrole for kube-scheduler</h5>

<p>If RBAC is enabled on your cluster, you must update the system:kube-scheduler cluster role. Edit the clusterrole for kube-scheduler and modify.</p>

<p>Below are the key changes made in orignal file</p>

<ul>
  <li>line 33: - my-scheduler</li>
  <li>line 131: - storageclasses</li>
</ul>

<figure class="highlight"><pre><code class="language-console" data-lang="console"><span class="gp">vikki@kubernetes1:~$</span><span class="w"> </span>kubectl edit clusterrole system:kube-scheduler</code></pre></figure>
<!--kg-card-begin: html-->
<script src="https://gist.github.com/vigneshragupathy/801aa697779378ff30e46e5247de8980.js"></script>
<!--kg-card-end: html-->
<h5 id="step-4-create-pods-with-different-types-of-scheduler">Step 4: Create pods with different types of scheduler</h5>

<p>Create a pod without explicitly mentioning any scheuler name. This pod should be scheduled by default scheduler <em>kube-scheduler</em></p>

<figure class="highlight"><pre><code class="language-console" data-lang="console"><span class="gp">vikki@kubernetes1:~$</span><span class="w"> </span>vim pod_default_scheduler.yaml</code></pre></figure>
<!--kg-card-begin: html-->
<script src="https://gist.github.com/vigneshragupathy/cfe05dda5b00a4f170b9cdd08f6aa0dd.js"></script>
<!--kg-card-end: html-->

<p>Create a pod by explicitly mentioning custom scheuler name <em>my-scheduler</em>.</p>

<figure class="highlight"><pre><code class="language-console" data-lang="console"><span class="gp">vikki@kubernetes1:~$</span><span class="w"> </span>vim pod_custom_scheduler.yaml </code></pre></figure>
<!--kg-card-begin: html-->
<script src="https://gist.github.com/vigneshragupathy/04cc5ac3e1933b4c1979a631de424116.js"></script>
<!--kg-card-end: html-->
<figure class="highlight"><pre><code class="language-console" data-lang="console"><span class="gp">vikki@kubernetes1:~$</span><span class="w"> </span>kubectl create <span class="nt">-f</span> pod_default_scheduler.yaml 
<span class="go">pod/nginx-pod-default-scheduler created
</span><span class="gp">vikki@kubernetes1:~$</span><span class="w"> </span>kubectl create <span class="nt">-f</span> pod_custom_scheduler.yaml 
<span class="go">pod/nginx-pod-custom-scheduler created</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-console" data-lang="console"><span class="gp">vikki@kubernetes1:~$</span><span class="w"> </span>kubectl get pods nginx-pod-custom-scheduler nginx-pod-default-scheduler
<span class="go">NAME READY STATUS RESTARTS AGE
nginx-pod-custom-scheduler 1/1 Running 0 9m9s
nginx-pod-default-scheduler 1/1 Running 0 9m13s
</span><span class="gp">vikki@kubernetes1:~$</span><span class="w"> </span></code></pre></figure>

<blockquote>
  <p>Now we can see both the pods are created and running</p>
</blockquote>

<figure class="highlight"><pre><code class="language-console" data-lang="console"><span class="gp">vikki@kubernetes1:~$</span><span class="w"> </span>kubectl get events <span class="nt">-o</span> wide |grep nginx-pod-custom-scheduler |head <span class="nt">-1</span>
<span class="gp">&lt;unknown&gt;</span><span class="w"> </span>Normal Scheduled pod/nginx-pod-custom-scheduler my-scheduler Successfully assigned default/nginx-pod-custom-scheduler to kubernetes3 &lt;unknown&gt; 0 nginx-pod-custom-scheduler.15da76383c2c2859
<span class="go">
</span><span class="gp">vikki@kubernetes1:~$</span><span class="w"> </span>kubectl get events <span class="nt">-o</span> wide |grep nginx-pod-default-scheduler |head <span class="nt">-1</span>
<span class="gp">&lt;unknown&gt;</span><span class="w"> </span>Normal Scheduled pod/nginx-pod-default-scheduler default-scheduler Successfully assigned default/nginx-pod-default-scheduler to kubernetes3 &lt;unknown&gt; 0 nginx-pod-default-scheduler.15da76372f4444f7</code></pre></figure>

<blockquote>
  <p>From the events, we can see pod nginx-pod-custom-scheduler is scheduled by <em>my-scheduler</em> and nginx-pod-default-scheduler by  <em>default-scheduler.</em></p>
</blockquote>

